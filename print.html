<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tydi</title>
        
        <meta name="robots" content="noindex" />
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="An open specification for complex data structures over hardware streams">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="index.html">Tydi</a></li><li class="spacer"></li><li class="expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="expanded "><a href="specification/index.html"><strong aria-hidden="true">2.</strong> Tydi specification</a></li><li><ol class="section"><li class="expanded "><a href="specification/intro.html"><strong aria-hidden="true">2.1.</strong> Introduction</a></li><li class="expanded "><a href="specification/physical.html"><strong aria-hidden="true">2.2.</strong> Physical streams</a></li><li class="expanded "><a href="specification/logical.html"><strong aria-hidden="true">2.3.</strong> Logical streams</a></li></ol></li><li class="expanded "><a href="tools/index.html"><strong aria-hidden="true">3.</strong> Tools</a></li><li><ol class="section"><li class="expanded "><a href="tools/generators.html"><strong aria-hidden="true">3.1.</strong> Generators</a></li><li class="expanded "><a href="tools/compositors.html"><strong aria-hidden="true">3.2.</strong> Compositors</a></li></ol></li><li class="expanded "><a href="faq.html">Frequently Asked Questions</a></li><li class="expanded affix "><a href="references.html">References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Tydi</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                            <a href="https://github.com/abs-tudelft/tydi" title="Git repository" aria-label="Git repository">
                                <i id="git-repository-button" class="fa fa-github"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#tydi-an-open-specification-for-complex-data-structures-over-hardware-streams" id="tydi-an-open-specification-for-complex-data-structures-over-hardware-streams">Tydi: an open specification for complex data structures over hardware streams</a></h1>
<h1><a class="header" href="#1-introduction" id="1-introduction">1. Introduction</a></h1>
<p>Tydi is an open-source project that aims to standardize interfaces for 
hardware components used in modern streaming dataflow designs.</p>
<p>The project consists of two parts: the Tydi specification and a set of 
reference implementations of useful tools.</p>
<h2><a class="header" href="#specification" id="specification">Specification</a></h2>
<p>The Tydi (Typed dataflow interface) specification is at the core of the
project: it defines what an interface should look like and constrains its
behavior, based on a constructively defined, low-level data type. Start
reading <a href="./specification/index.html">here</a>.</p>
<h2><a class="header" href="#tools" id="tools">Tools</a></h2>
<p>Using the Tydi specifications, reference implementations of tools are 
implemented and open-sourced.</p>
<ol>
<li><a href="./tools/generators.html">Generators</a> (under construction)</li>
<li><a href="./tools/compositors.html">Compositors</a> (under construction)</li>
</ol>
<p><strong>Generators</strong> create HDL templates, that users may fill in with their 
desired behavior. Tydi aims to impose <em>no restrictions</em> on what 
hardware-description languages are used to work with the specification.
Tydi aims to provide generators for old HDLs, such as VHDL and Verilog, 
but also modern HDL</p>
<p><strong>Compositors</strong> are tools that combine streamlets into larger designs.</p>
<h1><a class="header" href="#tydi-an-open-specification-for-complex-data-structures-over-hardware-streams-1" id="tydi-an-open-specification-for-complex-data-structures-over-hardware-streams-1">Tydi: an open specification for complex data structures over hardware streams</a></h1>
<h1><a class="header" href="#1-introduction-1" id="1-introduction-1">1. Introduction</a></h1>
<p>Tydi is an open-source project that aims to standardize interfaces for 
hardware components used in modern streaming dataflow designs.</p>
<p>The project consists of two parts: the Tydi specification and a set of 
reference implementations of useful tools.</p>
<h2><a class="header" href="#specification-1" id="specification-1">Specification</a></h2>
<p>The Tydi (Typed dataflow interface) specification is at the core of the
project: it defines what an interface should look like and constrains its
behavior, based on a constructively defined, low-level data type. Start
reading <a href="./specification/index.html">here</a>.</p>
<h2><a class="header" href="#tools-1" id="tools-1">Tools</a></h2>
<p>Using the Tydi specifications, reference implementations of tools are 
implemented and open-sourced.</p>
<ol>
<li><a href="./tools/generators.html">Generators</a> (under construction)</li>
<li><a href="./tools/compositors.html">Compositors</a> (under construction)</li>
</ol>
<p><strong>Generators</strong> create HDL templates, that users may fill in with their 
desired behavior. Tydi aims to impose <em>no restrictions</em> on what 
hardware-description languages are used to work with the specification.
Tydi aims to provide generators for old HDLs, such as VHDL and Verilog, 
but also modern HDL</p>
<p><strong>Compositors</strong> are tools that combine streamlets into larger designs.</p>
<h1><a class="header" href="#tydi-specification" id="tydi-specification">Tydi specification</a></h1>
<p>The Tydi specification, short for Typed dataflow interface specification,
aims to provide a standardized way in which complex data types can be
transferred from one circuit to another, within the context of FPGAs or
ASICs.</p>
<h2><a class="header" href="#how-to-read-this-document" id="how-to-read-this-document">How to read this document</a></h2>
<p>The specification is comprised of the following sections.</p>
<ul>
<li>
<p><a href="specification/intro.html">Introduction</a>: defines the motivation and scope of this
specification.</p>
</li>
<li>
<p><a href="specification/physical.html">Physical stream specification</a>. <strong>Physical streams</strong> are
hardware streams with their own valid/ready handshaking interface,
transporting elementary data and dimensionality information. Their exact
bit-level representation and transfer behavior is defined through five
parameters. These parameters are normally derived from logical streams.</p>
</li>
<li>
<p><a href="specification/logical.html">Logical stream specification</a>. <strong>Logical streams</strong> are bundles
of one or multiple physical streams of some type from the Tydi type system.
Types expressed in this type system determine which physical streams with
which parameters make up the logical stream. This section also introduces
<strong>streamlets</strong>, the Tydi name for components that have logical streams as
inputs and/or outputs.</p>
</li>
</ul>
<p>The two specification sections are written such that the first paragraph of
each section <em>defines</em> a new concept, and the subsequent paragraphs <em>constrain</em>
it.</p>
<blockquote>
<p>Additional information, such as examples, a more intuitive description, or
motivation, is written in these kinds of blocks.</p>
</blockquote>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>This section describes the motivation and scope of the Tydi specification.</p>
<h2><a class="header" href="#background-and-motivation" id="background-and-motivation">Background and motivation</a></h2>
<p>As FPGAs become faster and larger, they are increasingly used within a
data center context to accelerate computational workloads. FPGAs can already
achieve greater compute density and power efficiency than CPUs and GPUs for
certain types of workloads, particularly those that rely on high streaming
throughput and branch-heavy computation. Examples of this are decompression,
SQL query acceleration, and pattern matching. The major disadvantage of FPGAs
is that they are more difficult to program than CPUs and GPUs, and that
algorithms expressed imperatively in the CPU/GPU domain often need to be
redesigned from the ground up to achieve competitive performance. Both the
advantages and disadvantages are due to the spatial nature of an FPGA: instead
of programming a number of processors, an FPGA designer &quot;programs&quot; millions of
basic computational elements not much more complex than a single logic gate
that all work parallel to each other, and describes how these elements are
interconnected. This extreme programmability comes at a cost of roughly an
order of magnitude in area and an order of magnitude in performance compared
to the custom silicon used to make CPUs and GPUs. Therefore, while imperative
algorithms can indeed be mapped to FPGAs more or less directly through
high-level synthesis (HLS) techniques or the use of softcores, typically an
algorithm needs at least two orders of magnitude of acceleration through clever
use of the spatial nature of the FPGA to be competitive.</p>
<p>Unfortunately, the industry-standard toolchains needed to program FPGAs only
take VHDL, Verilog, SystemC, (more recently through HLS) a subset of C++,
and/or visually designed data flow graphs as their input. The first three
provide few abstractions above the level of a single wire: while they do allow
the use of data types such as integers and structures to represent bundles of
wires, all control of what the voltages on those bundles of wires represent at
a certain point in time (if anything) remains up to the programmer. The latter
two techniques raise the bar slightly by presenting the designer with streams
and memory. However, they are vendor-specific, often require additional
licensing fees over the more traditional design entry methods, and in some
cases are even specific to a certain version of the vendor tool and/or a
certain FPGA device family.</p>
<p>This situation has given rise to a number of open-source projects that take
higher-level languages and transform them to vendor-agnostic VHDL or Verilog.
Examples of this are <a href="https://www.chisel-lang.org/">Chisel/FIRRTL</a> and
<a href="https://clash-lang.org/">Clash</a>, using generative Scala code and a
Haskell-like functional programming language as their respective inputs. Both
tools come with their own standard libraries of hardware components that can be
used to compose accelerators out of smaller primitives, similar to the data
flow design method described earlier, but with textual input and the advantage
of being vendor and device agnostic.</p>
<p>With the advent of these data flow composition tools, it is increasingly
important to have a common interface standard to allow the primitive blocks to
connect to each other. The de-facto standard for this has become the AMBA AXI4
interface, designed by ARM for their microcontrollers and processors. Roughly
speaking, AXI4 specifies an interface for device-to-memory connections
(<a href="https://static.docs.arm.com/ihi0022/d/IHI0022D_amba_axi_protocol_spec.pdf">AXI4 and AXI4-lite</a>),
and a streaming interface
(<a href="https://static.docs.arm.com/ihi0051/a/IHI0051A_amba4_axi4_stream_v1_0_protocol_spec.pdf">AXI4-stream</a>)
for intra-device connections.</p>
<p>While AXI4 and AXI4-lite are of primary importance to processors due to their
memory-oriented nature, AXI4-stream is much more important for FPGAs due to
their spatial nature. However, because AXI4-stream is not originally designed
for FPGAs, parts of the specifications are awkward for this purpose. For
instance, AXI4-stream is byte oriented: it requires its data signal to be
divided into one or more byte lanes, and specifies (optional) control signals
that indicate the significance of each lane. Since FPGA designs are not at all
restricted to operating on byte elements, this part of the specification is
often ignored, and as such, any stream with a <code>valid</code>, <code>ready</code>, and one or more
<code>data</code> signals of any width has become the de-facto streaming standard. This is
reflected for instance by Chisel's built-in <code>Decoupled</code> interface type.</p>
<p>Within a single design this is of course not an issue â€” as long as both the
stream source and sink blocks agree on the same noncompliant interface, the
design will work. However, bearing in mind that there is an increasing number
of independently developed data flow oriented tools, each with their own
standard library, interoperability becomes an issue: whenever a designer needs
to use components from different vendors, they must first ensure that the
interfaces match, and if not, insert the requisite glue logic in between.</p>
<p>A similar issue exists in the software domain, where different programming
languages use different runtime environments and calling conventions. For
instance, efficiently connecting a component written in Java to a component
written in Python requires considerable effort. The keyword here is
&quot;efficiently:&quot; because Java and Python have very different ways of representing
abstract data in memory, one fundamentally has to convert from one
representation to another for any communication between the two components.
This serialization and deserialization overhead can and often does cost more
CPU time than the execution of the algorithms themselves.</p>
<p>The <a href="https://arrow.apache.org/">Apache Arrow</a> project attempts to solve this
problem by standardizing a way to represent this abstract data in memory, and
providing libraries for popular programming languages to interact with this
data format. The goal is to make transferring data between two processes as
efficient as sharing a pool of Arrow-formatted memory between them. Arrow also
specifies efficient ways of serializing Arrow data structures for (temporary)
storage in files or streaming structures over a network, and can also be used
by GPUs through CUDA. However, FPGA-based acceleration is at the time of
writing missing from the core project. The
<a href="https://github.com/abs-tudelft/fletcher">Fletcher</a> project attempts to bridge
this gap, by providing an interface layer between the Arrow in-memory format
and FPGA accelerators, presenting the memory to the accelerator in an abstract,
tabular form.</p>
<p>In order to represent the complex, nested data types supported by Arrow, the
Fletcher project had to devise its own data streaming format on top of the
de-facto subset of AXI4-stream. Originally, this format was simply a means
to an end, and therefore, not much thought was put into it. Particularly, as
only Arrow-to-device interfaces (and back) were needed for the project, an
interface designed specifically for intra-device streaming is lacking; in
fact, depending on configuration, the reader and writer interfaces do not even
match completely. Clearly, a standard for streaming complex data types between
components is needed, both within the context of the Fletcher project, and
outside of it.</p>
<p>As far as the writers are aware, no such standard exists as of yet. Defining
such a standard in an open, royalty-free way is the primary purpose of this
document.</p>
<h2><a class="header" href="#goals" id="goals">Goals</a></h2>
<ul>
<li>
<p>Defining a streaming format for complex data types in the context of FPGAs
and, potentially, ASICs, where &quot;complex data types&quot; include:</p>
<ul>
<li>multi-dimensional sequences of undefined length;</li>
<li>unions (a.k.a. variants);</li>
<li>structures such as tuples or records.</li>
</ul>
</li>
<li>
<p>Doing the above in as broad of a way as possible, without imposing
unnecessary burdens on the development of simple components.</p>
</li>
<li>
<p>Allowing for minimization of area and complexity through well-defined
contracts between source and sink on top of the signal specification itself.</p>
</li>
<li>
<p>Extensibility: this specification should be as usable as possible, even to
those with use cases not foreseen by this specification.</p>
</li>
</ul>
<h2><a class="header" href="#non-goals" id="non-goals">Non-goals</a></h2>
<ul>
<li>
<p>In this specification, a &quot;streaming format&quot; refers to the way in which the
voltages on a bundle of wires are used to communicate data. We expressly do
NOT mean streaming over existing communication formats such as Ethernet, and
certainly not over abstract streams such as POSIX pipes or other
inter-process communication paradigms. If you're looking for the former,
have a look at
<a href="https://arrow.apache.org/blog/2019/10/13/introducing-arrow-flight/">Arrow Flight</a>.
The latter is part of Apache Arrow itself through their
<a href="https://arrow.apache.org/docs/ipc.html">IPC format specification</a>.</p>
</li>
<li>
<p>We do not intend to compete with the AXI4(-stream) specification.
AXI4-stream is designed for streaming unstructured byte-oriented data;
Tydi streams are for streaming structured, complex data types.</p>
</li>
<li>
<p>Tydi streams have no notion of multi-endpoint network-on-chip-like
structures. Adding source and destination addressing or other routing
information can be done through the <code>user</code> signal.</p>
</li>
<li>
<p>The primitive data type in Tydi is a group of bits. We leave the mapping
from these bits to higher-order types such as numbers, characters, or
timestamps to existing specifications.</p>
</li>
</ul>
<h1><a class="header" href="#physical-streams" id="physical-streams">Physical streams</a></h1>
<p>A Tydi physical stream carries a stream of elements, dimensionality information
for said elements, and (optionally) user-defined transfer information from a
source to a sink. The contents of these three groups and to some extent the way
in which they are transferred are defined in a parameterized way, to provide
the necessary flexibility for the higher levels of this specification, and to
give hardware developers the freedom to optimize their designs. Based on these
parameters, this specification defines which signals must exist on the
interface, and the significance of these signals.</p>
<h2><a class="header" href="#parameters" id="parameters">Parameters</a></h2>
<p>A physical stream interface has five parameters, described in the following
subsections.</p>
<blockquote>
<p>The parameters are defined on the interfaces of the source and the sink
rather than the stream between them, because the complexity parameter need
not be the same on the source and sink. The others do.</p>
</blockquote>
<h3><a class="header" href="#element-content" id="element-content">Element content</a></h3>
<p>This describes the physical layout of the elementary data being transferred by
the stream. It is an emptyable, ordered set of named fields, where each field
has a name and a bit count.</p>
<blockquote>
<p>The element type can be given zero fields to make a &quot;null&quot; stream. Such
streams can still be useful, as physical streams also carry metadata.</p>
</blockquote>
<p>\(E\) is used as a shorthand for the total number of bits in the element;
that is, the sum of the field bit count over all fields in the element.</p>
<h4><a class="header" href="#field-name" id="field-name">Field name</a></h4>
<p>The name of each field is a string consisting of letters, numbers, and/or
underscores.</p>
<p>The name cannot start or end with an underscore.</p>
<p>The name cannot start with a digit.</p>
<blockquote>
<p>It is illegal to start or end with an underscore or start with a number to
prevent confusion when the name is prefixed to form the signal name, and
for compatibility with VHDL.</p>
</blockquote>
<p>The name cannot be empty.</p>
<blockquote>
<p>Fields may be auto-named by the next layer of the spec based on the abstract
type if necessary.</p>
</blockquote>
<p>The name must be case-insensitively unique within the set of named fields.</p>
<blockquote>
<p>The identifier is case-insensitive because compatibility with VHDL is
desired.</p>
</blockquote>
<h4><a class="header" href="#bit-count" id="bit-count">Bit count</a></h4>
<p>The bit count cannot be zero.</p>
<blockquote>
<p>A lot of synthesis tools out there do not handle null ranges very well.</p>
</blockquote>
<h3><a class="header" href="#number-of-element-lanes-n" id="number-of-element-lanes-n">Number of element lanes (N)</a></h3>
<p>The signals used for describing a data element are replicated this many times,
allowing multiple elements to be transferred per stream handshake. \(N\) must
be an integer greater than or equal to one.</p>
<h3><a class="header" href="#dimensionality-d" id="dimensionality-d">Dimensionality (D)</a></h3>
<p>This parameter specifies the number of <code>last</code> bits needed to represent the
data. It must be an integer greater than or equal to zero.</p>
<blockquote>
<p>Intuitively, each sequence nesting level adds one to this number. For
instance, to stream two-dimensional sequences, two <code>last</code> bits are needed:
one to mark the boundaries of the inner sequence, and one to mark the
boundary of each two-dimensional sequence.</p>
</blockquote>
<h3><a class="header" href="#complexity-c" id="complexity-c">Complexity (C)</a></h3>
<p>This parameter specifies the guarantees a source makes about how elements
are transferred. Equivalently, it specifies the assumptions a sink can safely
make.</p>
<table><thead><tr><th>Higher C</th><th>Lower C</th></tr></thead><tbody>
<tr><td>Fewer guarantees made by source</td><td>More guarantees made by source</td></tr>
<tr><td>Source is easier to implement</td><td>Source is harder to implement</td></tr>
<tr><td>Sink can make fewer assumptions</td><td>Sink can make more assumptions</td></tr>
<tr><td>Sink is harder to implement</td><td>Sink is easier to implement</td></tr>
</tbody></table>
<p>The complexity levels and signals are defined such that a source with
complexity \(C_a\) can be connected to a sink with complexity
\(C_b \ge C_a\).</p>
<p>The complexity number is defined as a nonempty, period-separated list of
nonnegative integers. A complexity number is higher than another when the
leftmost integer is greater, and lower when the leftmost integer is lower. If
the leftmost integer is equal, the next integer is checked recursively. If one
complexity number has more entries than another, the shorter number is padded
with zeros on the right.</p>
<blockquote>
<p>That is, it works a bit like a version number. The idea behind this is to
allow future version of this specification (or any other kind of addition
later) to insert new complexity levels between the ones defined here. For
instance, 3 &lt; 3.1 &lt; 3.1.1 &lt; 3.2 &lt; 4.</p>
</blockquote>
<p>The complexity number carries the following intuitive significance.</p>
<table><thead><tr><th>\(C\)</th><th>Description</th></tr></thead><tbody>
<tr><td>&lt; 8</td><td>Only one sequence can be terminated per transfer.</td></tr>
<tr><td>&lt; 7</td><td>The indices of the active data lanes can be described with a simple range.</td></tr>
<tr><td>&lt; 6</td><td>The range of active data lanes must always start with lane zero.</td></tr>
<tr><td>&lt; 5</td><td>All lanes must be active for all but the last transfer of the innermost sequence.</td></tr>
<tr><td>&lt; 4</td><td>The <code>last</code> flag cannot be postponed until after the transfer of the last element.</td></tr>
<tr><td>&lt; 3</td><td>Innermost sequences must be transferred in consecutive cycles.</td></tr>
<tr><td>&lt; 2</td><td>Whole outermost instances must be transferred in consecutive cycles.</td></tr>
</tbody></table>
<p>The exact requirements imposed for each \(C\) can be found along with the
unconditional signal requirements in later sections.</p>
<p>A stream is considered to be normalized when \(C &lt; 4\). At this complexity
level, there is a one-to-one mapping between the transferred data and the
actual transfers for any given \(N\). This is called the canonical
representation of the data for a given \(N\).</p>
<h3><a class="header" href="#user-defined-transfer-content" id="user-defined-transfer-content">User-defined transfer content</a></h3>
<p>This describes the physical layout of the user-defined transfer content of the
stream. It is an emptyable, ordered set of named fields, where each field has a
name and a bit count.</p>
<blockquote>
<p>These fields are like the fields in the element content, but are associated
to the physical stream transfers rather than the abstract data being
transferred. They are intended for adding lower-level user-defined protocol
signals to the stream, similar to the use of the <code>*USER</code> signals in AXI4.
For instance, physical streams could be transferred over a
network-on-chip-like structure by attaching routing information through this
method.</p>
</blockquote>
<p>The letter \(U\) is used as a shorthand for the total number of bits in the
transfer content; that is, the sum of the field bit count over all fields in
the transfer content.</p>
<h4><a class="header" href="#field-name-1" id="field-name-1">Field name</a></h4>
<p>The name of each field is a string consisting of letters, numbers, and/or
underscores.</p>
<p>The name cannot start or end with an underscore.</p>
<p>The name cannot start with a digit.</p>
<blockquote>
<p>It is illegal to start or end with an underscore or start with a number to
prevent confusion when the name is prefixed to form the signal name, and
for compatibility with VHDL.</p>
</blockquote>
<p>The name cannot be empty.</p>
<blockquote>
<p>Fields may be auto-named by the next layer of the spec based on the abstract
type if necessary.</p>
</blockquote>
<p>The name must be case-insensitively unique within the set of named fields.</p>
<blockquote>
<p>The identifier is case-insensitive because compatibility with VHDL is
desired.</p>
</blockquote>
<h4><a class="header" href="#bit-count-1" id="bit-count-1">Bit count</a></h4>
<p>The bit count cannot be zero.</p>
<blockquote>
<p>A lot of synthesis tools out there do not handle null ranges very well.</p>
</blockquote>
<h2><a class="header" href="#signals" id="signals">Signals</a></h2>
<p>A physical stream is comprised of the following signals.</p>
<table><thead><tr><th>Name</th><th>Origin</th><th>Purpose</th></tr></thead><tbody>
<tr><td><code>valid</code></td><td>Source</td><td>Stalling the data stream due to the source not being ready.</td></tr>
<tr><td><code>ready</code></td><td>Sink</td><td>Stalling the data stream due to the sink not being ready.</td></tr>
<tr><td><code>data</code></td><td>Source</td><td>Data transfer of \(N\) \(E\)-bit elements.</td></tr>
<tr><td><code>last</code></td><td>Source</td><td>Indicating the last transfer for \(D\) levels of nested sequences.</td></tr>
<tr><td><code>stai</code></td><td>Source</td><td>Start index; encodes the index of the first valid lane.</td></tr>
<tr><td><code>endi</code></td><td>Source</td><td>End index; encodes the index of the last valid lane.</td></tr>
<tr><td><code>strb</code></td><td>Source</td><td>Strobe; encodes individual lane validity for \(C \ge 8\), empty sequences otherwise.</td></tr>
<tr><td><code>user</code></td><td>Source</td><td>Additional control information carried along with the stream.</td></tr>
</tbody></table>
<p>The <code>valid</code> and <code>ready</code> signals are scalars, while all the other signals are
bit vectors with the following widths.</p>
<table><thead><tr><th>Name</th><th>Width</th></tr></thead><tbody>
<tr><td><code>valid</code></td><td><em>scalar</em></td></tr>
<tr><td><code>ready</code></td><td><em>scalar</em></td></tr>
<tr><td><code>data</code></td><td>\(N \times E\)</td></tr>
<tr><td><code>last</code></td><td>\(N \times D\)</td></tr>
<tr><td><code>stai</code></td><td>\(\lceil \log_2{N} \rceil\)</td></tr>
<tr><td><code>endi</code></td><td>\(\lceil \log_2{N} \rceil\)</td></tr>
<tr><td><code>strb</code></td><td>\(N\)</td></tr>
<tr><td><code>user</code></td><td>\(U\)</td></tr>
</tbody></table>
<h3><a class="header" href="#clock" id="clock">Clock</a></h3>
<p>All signals are synchronous to a single clock signal, shared between the source
and sink.</p>
<p>It is up to the user to manage clock domains and clock domain crossing where
needed, and specify the edge sensitivity of the clock(s).</p>
<h3><a class="header" href="#reset" id="reset">Reset</a></h3>
<p>This specification places no constraints on the reset signal. The requirements
on the <code>valid</code> and <code>ready</code> signals ensure that no transfers occur when either
the source or the sink is held under reset, so the source, synchronicity, and
sensitivity of the reset signal(s) can be chosen by the user.</p>
<h3><a class="header" href="#detailed-signal-description" id="detailed-signal-description">Detailed signal description</a></h3>
<h4><a class="header" href="#valid-signal-description" id="valid-signal-description"><code>valid</code> signal description</a></h4>
<blockquote>
<p>The <code>valid</code> signal has the same semantics as the <code>TVALID</code> AXI4-stream signal.
These semantics are repeated here.</p>
</blockquote>
<p>The <code>valid</code> signal indicates the presence of a valid transfer payload of the
other downstream signals. It is active-high.</p>
<p>The state of the <code>valid</code> signal is always significant.</p>
<blockquote>
<p>That is, if the source is in some undefined or &quot;uninitialized&quot; state, <code>valid</code>
<em>must</em> nonetheless be low.</p>
</blockquote>
<p>The downstream signals, including <code>valid</code>, must be stable (maintain their
state) from the first active clock edge in which <code>valid</code> is asserted until
acknowledgement of the transfer. Note that the validating and acknowledging
clock edge can be one and the same if <code>ready</code> is already asserted during the
first clock cycle; in this case there are no stability requirements.</p>
<blockquote>
<p>In other words, a transfer may not be cancelled or modified after validation.
This allows a sink to start doing some sort of multicycle processing as soon
as <code>valid</code> is asserted, only asserting <code>ready</code> when it is done, without
having to worry about cancellation or changes in the transfer content. This
prevents the need for extra holding registers or latches otherwise needed to
keep the original transfer.</p>
</blockquote>
<p>When a transfer is acknowledged, either the next transfer is presented on the
downstream signals and <code>valid</code> remains asserted, or <code>valid</code> is released.</p>
<p><em>[\(C &lt; 3\)]</em> <code>valid</code> may only be released when lane \(N - 1\) of the
<code>last</code> signal in the acknowledged transfer is nonzero.</p>
<p><em>[\(C &lt; 2\)]</em> <code>valid</code> may only be released when lane \(N - 1\) of the
<code>last</code> signal in the acknowledged transfer is all ones.</p>
<p><code>valid</code> must be released while the source is being reset.</p>
<blockquote>
<p>This prevents spurious transfers when the sink has a different reset source.</p>
</blockquote>
<h4><a class="header" href="#ready-signal-description" id="ready-signal-description"><code>ready</code> signal description</a></h4>
<blockquote>
<p>The <code>ready</code> signal has the same semantics as the <code>TREADY</code> AXI4-stream signal.
These semantics are repeated here.</p>
</blockquote>
<p>The <code>ready</code> signal indicates acknowledgement of a transfer initiated through
<code>valid</code>. It is active-high.</p>
<p>The state of the <code>ready</code> signal is significant only while <code>valid</code> is asserted.</p>
<blockquote>
<p>That is, a source must never wait for <code>ready</code> to assert before it asserts
<code>valid</code>. Doing so can lead to deadlock. However, a sink <em>may</em> wait for
<code>valid</code> to assert before asserting <code>ready</code>.</p>
</blockquote>
<p>A transfer is considered &quot;handshaked&quot; when both <code>valid</code> and <code>ready</code> are
asserted during the active clock edge of the clock domain common to the source
and the sink.</p>
<p><code>ready</code> must be released while the sink is being reset.</p>
<blockquote>
<p>This prevents transfers from being lost when the source has a different reset
source.</p>
</blockquote>
<h4><a class="header" href="#data-signal-description" id="data-signal-description"><code>data</code> signal description</a></h4>
<p>The <code>data</code> signal consists of <code>N</code> concatenated lanes, each carrying a number of
data element fields, totaling to <code>E</code> bits per lane.</p>
<p>The state of lane \(i\) in the <code>data</code> signal is significant only while
<code>valid</code> is asserted and data lane \(i\) is <em>active</em>. Data lane \(i\) is
considered active if and only if</p>
<ul>
<li>bit \(i\) of <code>strb</code> is asserted,</li>
<li>the unsigned integer interpretation of <code>endi</code> is greater than or equal to
\(i\), <em>and</em></li>
<li>the unsigned integer interpretation of <code>stai</code> is less than or equal to
\(i\).</li>
</ul>
<blockquote>
<p>The redundancy of the <code>endi</code> and <code>stai</code> signals given the presence of the
<code>strb</code> signal (only applicable for \(C \ge 7\)) has to do with the rule
that it must always be possible to connect a source with low complexity to a
sink with high complexity. That is, while a source that desires individual
control over the lanes and thus has \(C \ge 7\) would probably always
drive <code>endi</code> to \(N-1\) and <code>stai</code> to 0, a sink with complexity
\(C \ge 7\) still needs to accept input from sources that do use <code>endi</code>
and <code>stai</code>.</p>
<p>The overhead incurred by this should be negligible in practice. First of all,
because \(C \ge 7\) with significant \(N\) will be quite large to begin
with, so managing two additional signals of size
\(\lceil \log_2{N} \rceil\) probably doesn't matter much. Secondly, in most
cases, constant propagation will remove the unneeded <code>endi</code> and <code>stai</code>
signals whenever both source and sink have \(C \ge 7\). Finally, even if
the above fails, going from <code>stai</code> + <code>endi</code> + <code>strb</code> to the internal lane
enable signals in a sink is trivial for modern FPGAs and realistic \(N\),
as the less-than-equal and greater-than-equal comparisons fit in a single
6-LUT up to and including \(N = 64\), resulting in just three decoding
LUTs per lane (one for <code>stai</code>, one for <code>endi</code>, and one 3-input AND gate to
merge the outputs of the first two and the <code>strb</code> bit).</p>
</blockquote>
<p>The significant lanes are interpreted in order of increasing index for each
transfer.</p>
<h4><a class="header" href="#last-signal-description" id="last-signal-description"><code>last</code> signal description</a></h4>
<p>The <code>last</code> signal consists of <code>N</code> concatenated lanes, each carrying a
termination bit for each nested sequence represented by the physical stream.
The <code>last</code> bit for lane \(i\) and dimension \(j\) (i.e., bit
\(i \cdot D + j\)) being asserted indicates completion of a sequence with
nesting level \(D - j - 1\), containing all elements streamed between the
previous lane/transfer this occured for dimension \(j' \ge j\) (or system
reset, if never) exclusively and this point inclusively, where nesting level
is defined to be 0 for the outermost sequence, 1 for its inner sequence, up to
\(D - 1\) for the innermost sequence. It is active-high.</p>
<blockquote>
<p>For example, one way to represent the value
<code>[&quot;Hello&quot;, &quot;World&quot;], [&quot;Tydi&quot;, &quot;is&quot;, &quot;nice&quot;], [&quot;&quot;], []</code> with
\(N = 6, C \ge 8\) is as follows. Note that \(D = 2\) follows
from the data type, \(E\) depends on the character encoding, and the
example does not depend on \(U\).</p>
<pre><code class="language-text">reset released here
        |                      transfer --&gt;
        v      A              B              C              D

last    &quot;000100000000&quot; &quot;000011000000&quot; &quot;000001000100&quot; &quot;000010010000&quot;
data       &quot;WolleH&quot;       &quot;yTdlro&quot;       &quot;insiid&quot;       &quot;----ec&quot;
strb       &quot;111111&quot;       &quot;111111&quot;       &quot;111111&quot;       &quot;000011&quot;

        .------------. .------------. .------------. .------------.
      0 | data:  'H' | | data:  'o' | | data:  'd' | | data:  'c' |
        | last:  0 0 | | last:  0 0 | | last:  0 0 | | last:  0 0 |
        |------------| |------------| |------------| |------------|
      1 | data:  'e' | | data:  'r' | | data:  'i' | | data:  'e' |
        | last:  0 0 | | last:  0 0 | | last:  0 1 | | last:  0 0 |
        |------------| |------------| |------------| |------------|
lane  2 | data:  'l' | | data:  'l' | | data:  'i' | | data:   -  |
index   | last:  0 0 | | last:  0 0 | | last:  0 0 | | last:  0 1 |
  |     |------------| |------------| |------------| |------------|
  v   3 | data:  'l' | | data:  'd' | | data:  's' | | data:   -  |
        | last:  0 0 | | last:  1 1 | | last:  0 1 | | last:  1 0 |
        |------------| |------------| |------------| |------------|
      4 | data:  'o' | | data:  'T' | | data:  'n' | | data:   -  |
        | last:  0 1 | | last:  0 0 | | last:  0 0 | | last:  1 1 |
        |------------| |------------| |------------| |------------|
      5 | data:  'W' | | data:  'y' | | data:  'i' | | data:   -  |
        | last:  0 0 | | last:  0 0 | | last:  0 0 | | last:  1 0 |
        '------------' '------------' '------------' '------------'
</code></pre>
<p><code>&quot;Hello&quot;</code> is delimited by the reset condition and the asserted <code>last</code> bit
in transfer A, lane 4, dimension 0 (innermost). <code>&quot;World&quot;</code> is delimited
by the aforementioned and the <code>last</code> bit in transfer B, lane 3, also for
dimension 0. The <code>last</code> bit for B3/dimension 1 is also asserted, which
delimits <code>[&quot;Hello&quot;, &quot;World&quot;]</code> along with the reset condition; both the
<code>&quot;Hello&quot;</code> and <code>&quot;World&quot;</code> sequence are fully contained by the delimited
portion of the stream, so the outer sequence has those as its two entries.
<code>&quot;Tydi&quot;</code> is delimited by B3 and C1, <code>&quot;is&quot;</code> by C1 and C3, and <code>&quot;nice&quot;</code> by
C3 and D2 for dimension 0. Note that the D2 is postponed beyond the last
element (D1) by means of deactivating data lane D2. The <code>last</code> flag for
the surrounding sequence is similarly postponed to D3; note though that data
lane D3 <em>must</em> be inactive, <em>or</em> the last bit for D3/dimension 0 must be
asserted for the data stream to be legal. The next <code>&quot;&quot;</code> is delimited by
D3/dimension 1 and D4/dimension 0, and <code>[&quot;&quot;]</code> is delimited by D3 and D4
for dimension 1. The final <code>[]</code> is delimited by D4 and D5 for dimension 1.
It does not contain an inner sequence item because D5/dimension 0 is not
asserted, so the outer sequence is empty.</p>
</blockquote>
<p>The state of lane \(i\) in the <code>data</code> signal is significant only while
<code>valid</code> is asserted.</p>
<blockquote>
<p>Note that the validity of the <code>last</code> lanes is thus <em>not</em> controlled by
which data lanes are active. This allows sequences to be terminated without
sending an element; this is in fact required in order to send empty
sequences, but also allows postponing the end-of-sequence marker until after
the last element (if complexity allows) as the previous example shows.</p>
</blockquote>
<p>It is illegal to assert a <code>last</code> bit for dimension \(j\) without first
terminating all dimensions \(j' &lt; j\), if any data lanes were active since
the previous assertion of a <code>last</code> bit for dimension 0.</p>
<blockquote>
<p>For example, the following is illegal because of the above:</p>
<pre><code class="language-text">        .------------.
      0 | data:  '1' |
        | last:  0 0 |
        |------------|
      1 | data:  '2' |
        | last:  0 1 |
        |------------|
lane  2 | data:  '3' |
index   | last:  0 0 |
  |     |------------|
  v   3 | data:  '4' |
        | last:  1 0 |
        |------------|
      4 | data:  '5' |
        | last:  0 0 |
        |------------|
      5 | data:  '6' |
        | last:  1 1 |
        '------------'
</code></pre>
<p>An argument could be made that this encodes <code>[[1, 2], 3, 4], [[5, 6]]</code>, but
allowing this interpretation would make the stream significantly less
type-safe, and there would be no way to encode non-sequence elements before
the last inner sequence in the outer sequence without introducing a <code>start</code>
signal as well.</p>
<p>An argument could also be made that this encodes <code>[[1, 2]], [[3, 4, 5, 6]]</code>,
because the <code>last</code> flag delimiting <code>[1, 2]</code> falls within the first outer
sequence and the <code>last</code> flag delimiting <code>[3, 4, 5, 6]</code> falls within the
second. However, this would unnecessarily complicate sink logic, make manual
interpretation of the data structure more context-sensitive, and so on.</p>
<p>One could also argue that it encodes <code>[[1, 2]], [[5, 6]]</code>, because <code>3</code> and
<code>4</code> are not enclosed by any inner sequence, but then it makes more sense to
just deactivate the lanes.</p>
<p>Ultimately, this representation is ambiguous or at least leads to confusion,
and is therefore illegal.</p>
</blockquote>
<p><em>[\(C &lt; 8\)]</em> All last bits for lanes 0 to \(N - 2\) inclusive must be
driven low by the source, and may be ignored by the sink.</p>
<blockquote>
<p>The above rule ultimately means that the <code>last</code> information is transferred on
a transfer basis instead of on element basis, similar to AXI4-stream. This
can significantly decrease decoding complexity, but only allows one innermost
sequence to be transferred per cycle regardless of (N\) and the length of
the sequence.</p>
</blockquote>
<p><em>[\(C &lt; 4\)]</em> It is illegal to assert a <code>last</code> bit for dimension \(j\)
without also asserting the <code>last</code> bits for dimensions \(j' &lt; j\) in the same
lane.</p>
<p><em>[\(C &lt; 4\)]</em> It is illegal to assert the <code>last</code> bit for dimension 0 when
the respective data lane is inactive, except for empty sequences.</p>
<blockquote>
<p>The above two rules mean that the <code>last</code> flags cannot be postponed.</p>
</blockquote>
<h4><a class="header" href="#stai-signal-description" id="stai-signal-description"><code>stai</code> signal description</a></h4>
<p>The <code>stai</code> signal (start index) is used to deactivate data lanes with an index
lower than the encoded binary number. It is a bit vector of size
\(\lceil \log_2{N} \rceil\) to encode the full index range.</p>
<p>The state of the <code>stai</code> signal is significant only while <code>valid</code> is asserted.</p>
<p>It is illegal to drive <code>stai</code> to the value \(N\) or greater.</p>
<blockquote>
<p>This implies that <code>stai</code> cannot be used to disable the last lane.</p>
</blockquote>
<p><em>[\(C &lt; 6\)]</em> <code>stai</code> must always be driven to 0 by the source, and may be
ignored by the sink.</p>
<h4><a class="header" href="#endi-signal-description" id="endi-signal-description"><code>endi</code> signal description</a></h4>
<p>The <code>endi</code> signal (end index) is used to deactivate data lanes with an index
greater than the encoded binary number. It is a bit vector of size
\(\lceil \log_2{N} \rceil\) to encode the full index range.</p>
<blockquote>
<p>Note that <code>endi</code> cannot be used to disable the first lane.</p>
</blockquote>
<p>The state of the <code>endi</code> signal is significant only while <code>valid</code> is asserted.</p>
<p>It is illegal to drive <code>endi</code> to the value \(N\) or greater.</p>
<blockquote>
<p>This would semantically not be different from driving \(N - 1\), so there
is no reason to burden the sink logic by allowing this case.</p>
</blockquote>
<p>It is illegal to drive <code>endi</code> to a value less than <code>stai</code>.</p>
<blockquote>
<p>This would essentially encode a VHDL null range, which, if allowed, could be
used to encode empty sequences. However, detecting this condition is
relatively hard on FPGA resources (timing in particular), typically requiring
a carry chain for \(N &gt; 8\). Instead, use <code>strb</code> for this purpose; at lower
complexities all <code>strb</code> bits must be equal, so only a single bit has to be
checked to determine whether a transfer carries any data.</p>
</blockquote>
<p><em>[\(C &lt; 5\)]</em> <code>endi</code> must be driven to \(N - 1\) by the source when <code>last</code>
is zero, and may be ignored by the sink in this case.</p>
<blockquote>
<p>Together with the other complexity rules up to this level, this means that
all lanes must be used for all but the last transfer containing elements for
the innermost sequence. This furthermore implies that the element with
innermost index \(i\) is always transferred on data lane \(i \mod N\).</p>
</blockquote>
<h4><a class="header" href="#strb-signal-description" id="strb-signal-description"><code>strb</code> signal description</a></h4>
<p>The <code>strb</code> signal (strobe) is used to deactivate individual data lanes. It is
a bit vector of size \(N\). When a <code>strb</code> bit is low, the associated data
lane is deactivated.</p>
<blockquote>
<p>Note that the opposite (<code>strb</code> high -&gt; activated) is <em>not</em> necessarily true
due to <code>endi</code> and <code>stai</code>.</p>
</blockquote>
<p>The state of the <code>strb</code> signal is significant only while <code>valid</code> is asserted.</p>
<p><em>[\(C &lt; 8\)]</em> All <code>strb</code> bits must be driven to the same value by the source.
The sink only needs to interpret one of the bits.</p>
<blockquote>
<p>This effectively reduces the <code>strb</code> signal to a single bit indicating whether
the transfer is empty (low) or not (high), as it is illegal to deactivate all
data lanes by driving <code>endi</code> &lt; <code>stai</code>.</p>
</blockquote>
<h4><a class="header" href="#user-signal-description" id="user-signal-description"><code>user</code> signal description</a></h4>
<p>The <code>user</code> signal is the concatenation of a number of user-specified fields,
carrying additional transfer-oriented information. The significance of this is
user-defined.</p>
<p>The state of the <code>user</code> signal is not significant when <code>valid</code> is not asserted.</p>
<blockquote>
<p>The opposite is not necessarily true; it is up to the user's specifications
if (part of) the user signal can be insignificant despite <code>valid</code> being
asserted.</p>
</blockquote>
<h3><a class="header" href="#signal-omission" id="signal-omission">Signal omission</a></h3>
<p>Not all signals are always needed. The following table shows the condition for
a signal to be relevant. If the condition is false, the signal may be omitted
on the interface. When two interfaces with differing but compatible
complexities are connected together, the default value specified in the table
below must be driven for the omitted signals.</p>
<table><thead><tr><th>Name</th><th>Condition</th><th>Default</th></tr></thead><tbody>
<tr><td><code>valid</code></td><td><em>see below</em></td><td><code>'1'</code></td></tr>
<tr><td><code>ready</code></td><td><em>see below</em></td><td><code>'1'</code></td></tr>
<tr><td><code>data</code></td><td>\(E &gt; 0\)</td><td>all <code>'0'</code></td></tr>
<tr><td><code>last</code></td><td>\(D \ge 1\)</td><td>all <code>'1'</code></td></tr>
<tr><td><code>stai</code></td><td>\(C \ge 6 \wedge N &gt; 1\)</td><td>0</td></tr>
<tr><td><code>endi</code></td><td>\((C \ge 5 \vee D \ge 1) \wedge N &gt; 1\)</td><td>\(N-1\)</td></tr>
<tr><td><code>strb</code></td><td>\(C \ge 7 \vee D \ge 1\)</td><td>all <code>'1'</code></td></tr>
<tr><td><code>user</code></td><td>\(U &gt; 0\)</td><td>all <code>'0'</code></td></tr>
</tbody></table>
<p><code>valid</code> may be omitted for sources that are always valid.</p>
<blockquote>
<p>For example, a constant or status signal source (the latter must be valid
during reset as well for this to apply).</p>
</blockquote>
<p><code>ready</code> may be omitted for sinks that never block.</p>
<blockquote>
<p>For example, a sink that voids all incoming data in order to measure
performance of the source.</p>
</blockquote>
<h3><a class="header" href="#interface-conventions" id="interface-conventions">Interface conventions</a></h3>
<p>When there are name conflicts (for instance due to multiple physical streams
existing on the hierarchical level of an interface) the signal names must be
prefixed by a unique stream name, delimited using an underscore.</p>
<p>The canonical representation for the <code>data</code> and <code>user</code> signals is the LSB-first
concatenation of the contained fields. For \(N &gt; 1\), the lanes are
concatenated LSB first, such that the lane index is major and the field index
is minor.</p>
<p>Where applicable, the signals must be listed in the following order: <code>dn</code>,
<code>up</code>, <code>valid</code>, <code>ready</code>, <code>data</code>, <code>last</code>, <code>stai</code>, <code>endi</code>, <code>strb</code>, <code>user</code> (<code>dn</code>
and <code>up</code> are part of the alternative representation defined below).</p>
<blockquote>
<p>This is mostly just a consistency thing, primarily because it helps to get
used to a single ordering when interpreting simulation waveforms. It may also
simplify tooling.</p>
</blockquote>
<p>The signal names must be lowercase.</p>
<blockquote>
<p>This is for interoperability between languages that differ in case
sensitivity.</p>
</blockquote>
<h4><a class="header" href="#alternative-representation" id="alternative-representation">Alternative representation</a></h4>
<p>To improve code readability in hardware definition languages supporting array
and aggregate constructs (record, struct, ...), the following changes are
permissible. However, it is recommended to fall back to the conventions above
for interoperability with other streamlets on the &quot;outer&quot; interfaces of an IP
block.</p>
<ul>
<li>
<p><code>valid</code>, <code>data</code>, <code>last</code>, <code>stai</code>, <code>endi</code>, <code>strb</code>, and <code>user</code> may be bundled
in an aggregate type named <code>&lt;stream-name&gt;_dn_type</code> with signal name
<code>&lt;stream-name&gt;_dn</code> (<code>dn</code> is short for &quot;downstream&quot;).</p>
</li>
<li>
<p><code>ready</code> may be &quot;bundled&quot; in an aggregate type named <code>&lt;stream-name&gt;_up_type</code>
with signal name <code>&lt;stream-name&gt;_up</code> for symmetry (<code>up</code> is short for
&quot;upstream&quot;).</p>
</li>
<li>
<p>If the language allows for signal direction reversal within a bundle, all
stream signals may also be bundled into a single type named
<code>&lt;stream-name&gt;_type</code>, with <code>ready</code> in the reverse direction.</p>
</li>
<li>
<p>The data and user fields may be bundled in aggregate types named
<code>&lt;stream-name&gt;_data_type</code> and <code>&lt;stream-name&gt;_user_type</code> respectively. The
<code>data</code> signal becomes an array of <code>&lt;stream-name&gt;_data_type</code>s from 0 to
\(N - 1\) if \(N &gt; 1\) or when otherwise desirable.</p>
</li>
<li>
<p>Data and user fields consisting of a single bit may be interpreted as either
a bit vector of size one or a scalar bit depending on context.</p>
</li>
<li>
<p>Fields with a common underscore-delimited prefix may be aggregated
recursively using <code>&lt;stream-name&gt;_data_&lt;common-prefix&gt;_type</code>, in such a
way that the underscores in the canonical signal name are essentially
replaced with the hierarchy separator of the hardware definition language.</p>
</li>
</ul>
<h4><a class="header" href="#arrays-vectors-and-concatenations" id="arrays-vectors-and-concatenations">Arrays, vectors, and concatenations</a></h4>
<p>Where applicable, the bitrange for bit vector signals is always <code>n-1 downto 0</code>,
where <code>n</code> is the number of bits in the signal.</p>
<p>Concatenations of bit vector signals are done LSB-first.</p>
<blockquote>
<p>That is, lower indexed entries use lower bit indices and thus occur on the
right-hand side when the bit vector is written as a binary number. Note that
this results in the inverse order when using the concatenation operator in
VHDL (and possibly other languages). LSB-first order is chosen because it is
more intuitive when indexing the vector. Ultimately this is just a
convention.</p>
</blockquote>
<p>Where applicable, the range for arrays is always <code>0 to n-1</code>, where <code>n</code> is the
number of entries in the array.</p>
<blockquote>
<p>This is the more natural order for array-like structures, actually putting
the first entry on the left-hand side.</p>
</blockquote>
<h1><a class="header" href="#logical-streams" id="logical-streams">Logical streams</a></h1>
<p>(under construction)</p>
<h1><a class="header" href="#tools-2" id="tools-2">Tools</a></h1>
<p>(under construction)</p>
<h1><a class="header" href="#generators" id="generators">Generators</a></h1>
<p>(under construction)</p>
<h1><a class="header" href="#compositors" id="compositors">Compositors</a></h1>
<p>(under construction)</p>
<h1><a class="header" href="#frequently-asked-questions" id="frequently-asked-questions">Frequently Asked Questions</a></h1>
<h1><a class="header" href="#references" id="references">References</a></h1>
<ul>
<li><a href="https://mbrobbel.github.io/opentyde">Tydi playground</a>: an interactive 
playground to visualize Tydi types</li>
</ul>
<p>An early implementation from which the more generalized Tydi was spawned is 
Fletcher. Resources on Fletcher can be found here:</p>
<ul>
<li><a href="https://doi.org/10.1109/FPL.2019.00051">Fletcher general paper</a>: 
published in 2019 29th International Conference on Field Programmable Logic 
and Applications (FPL)</li>
<li><a href="https://link.springer.com/chapter/10.1007/978-3-030-17227-5_3">Fletcher hardware design</a>:
published in ARC 2019: Applied Reconfigurable Computing.</li>
<li><a href="https://github.com/abs-tudelft/fletcher">Fletcher</a>: 
the Fletcher project repository</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
